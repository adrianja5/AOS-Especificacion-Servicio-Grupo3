openapi: 3.0.2

info:
  title: '[Grupo 3] Especificación API REST Recambios'
  version: '1.0.0'

paths:
  /recambios:
    get:
      summary: Obtiene todos los recambios registrados del inventario
      description: |
        Los códigos de estado que puede devolver este endpoint son:
        | Status Code | Descripción          | Motivo                                                    |
        |-------------|----------------------|-----------------------------------------------------------|
        | **200**     | `OK`                 | Hay recambios registrados                                 |
        | **304**     | `NOT MODIFIED`       | Los recambios de la lista no han sido modificados         |
        | **400**     | `BAD REQUEST`        | Se ha introducido algún valor erróneo en la consulta      |
        | **404**     | `NOT FOUND`          | No existen recambios registrados                          |
        Se puede utilizar el ETag de una anterior consulta para caché.
      operationId: recambios_cget
      parameters:
        - $ref: "#/components/parameters/pageParam"
        - $ref: "#/components/parameters/limitParam"
        - $ref: "#/components/parameters/orderParam"
        - $ref: "#/components/parameters/orderingParam"
        - $ref: "#/components/parameters/nombreFilterParam"
        - $ref: "#/components/parameters/ifNoneMatchParam"
      responses:
        '200':
          description: >
            Lista de los recambios registrados
            y links a las páginas `first`, `last`,
            `prev` (si no es la primera) y `next` (si no es la última)
          headers:
            ETag:
              $ref: "#/components/headers/ETag"
          content:
            application/json:
              schema:
                type: object
                properties:
                  recambios:
                    description: Lista de recambios
                    type: array
                    items:
                      $ref: "#/components/schemas/Recambio"
                  links:
                    description: Enlaces de paginación
                    type: object
                    properties:
                      first:
                        $ref: "#/components/schemas/Link"
                      last:
                        $ref: "#/components/schemas/Link"
                      prev:
                        $ref: "#/components/schemas/Link"
                      next:
                        $ref: "#/components/schemas/Link"
        '400':
          description: '`BAD REQUEST`: Se ha introducido algún valor erróneo en la consulta.
                        Por ejemplo, se ha introducido un número de página menor que `1`
                        o el límite introducido es menor que `0`.'
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/HTTP_Problem"
              examples:
                response-http-400-recambios-get:
                  value:
                    type: https://httpstatuses.com/400
                    title: BAD REQUEST
                    status: 400
                    detail: Se ha introducido algún valor erróneo en la consulta.
                    instance: about:blank
        '304':
          $ref: '#/components/responses/Response_304'
        '404':
          $ref: '#/components/responses/Response_404'

    #put:
    #  summary: Modifica un recambio
    #  description: |
    #    La siguiente tabla define los códigos de estado que puede devolver este endpoint
    #    | Status Code | Descripción         | Motivo                                        |
    #    | ------------| --------------------| ----------------------------------------------|
    #    | **200**     | OK                  | El recambio se ha modificado correctamente    |
    #    | **404**     | NOT FOUND           | Si el recambio no existe                      |
    #  operationId: recambio_put
    #  parameters:
    #    - $ref: '#/components/parameters/ifMatchParam'
    #  requestBody:
    #    $ref: '#/components/requestBodies/recambioUpdate'
    #  responses:
    #    '200':
    #      description: '`OK`: el recambio ha sido modificado'
    #      content:
    #        application/json:
    #          schema:
    #            $ref: '#/components/schemas/Recambio'
    #    '404':
    #      $ref: '#/components/responses/Response_404'
  /recambios/{recambioId}:
    parameters:
      - $ref: '#/components/parameters/recambioId'
    get:
      summary: Obtiene un recambio identificado por su `recambioId`
      description: |        
        La siguiente tabla define los códigos de estado que puede devolver este endpoint
        
        | Status Code      | Descripción | Motivo                             |
        | ---------------- | ------------| -----------------------------------|
        | **200**          | OK          | Si el recambio existe                 |
        | **404**          | NOT FOUND   | Si el recambio no existe              |
      responses:
        '200':
          description: Videojuego
          headers:
            ETag:
              $ref: '#/components/headers/ETag'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Recambio'
              examples:
                recambioExample:
                  $ref: '#/components/examples/recambio-example'
        '404':
          $ref: '#/components/responses/Response_404'

    delete:
      summary: descataloga un recambio identificado por su `recambioId`
      description: |
        La siguiente tabla define los códigos de estado que puede devolver este endpoint
        
        | Status Code      | Descripción | Motivo                                    |
        | ---------------- | ------------| ------------------------------------------|
        | **204**          | NO CONTENT  | El recambio existía y ha sido eliminado |
        | **404**          | NOT FOUND   | Si el recambio no existe                |

      responses:
        '204':
          description: recambio eliminado &lt;Cuerpo de la respuesta vacío&gt;
        '404':
          $ref: '#/components/responses/Response_404'
  /recambios/{recambioId}/equivalencias:
    parameters:
      - $ref: '#/components/parameters/recambioId'
    get:
      summary: Obtiene todos los recambios equivalentes con el recambio indicado
      description: |
        Los códigos de estado que puede devolver este endpoint son:
        | Status Code | Descripción          | Motivo                                                    |
        |-------------|----------------------|-----------------------------------------------------------|
        | **200**     | `OK`                 | Hay recambios equivalentes                                |
        | **304**     | `NOT MODIFIED`       | Los recambios equivalentes no han sido modificados        |
        | **404**     | `NOT FOUND`          | No existen recambios registrados                          |
        Se puede utilizar el ETag de una anterior consulta para caché.
      operationId: recambios_equivalencias_cget
      responses:
        '200':
          description: Lista de los recambios equivalentes
          headers:
            ETag:
              $ref: "#/components/headers/ETag"
          content:
            application/json:
              schema:
                type: object
                properties:
                  recambios:
                    description: Lista de recambios
                    type: array
                    items:
                      $ref: "#/components/schemas/Recambio"
                  links:
                    description: Enlaces de relación
                    type: object
                    properties:
                      parent:
                        $ref: "#/components/schemas/Link"
                      self:
                        $ref: "#/components/schemas/Link"
        '304':
          $ref: '#/components/responses/Response_304'
        '404':
          $ref: '#/components/responses/Response_404'
  /recambios/{recambioId}/equivalencias/{recambioEquivalenteId}:
    parameters:
    - $ref: "#/components/parameters/recambioId"
    - $ref: "#/components/parameters/recambioEquivalenteId"
    get:
      summary: Obtiene el recambio equivalente si lo es
      description: |
        Los códigos de estado que puede devolver este endpoint son:
        | Status Code | Descripción          | Motivo                                                            |
        |-------------|----------------------|-------------------------------------------------------------------|
        | **200**     | `OK`                 | Ambos recambios existen y el recambio es equivalente              |
        | **404**     | `NOT FOUND`          | Alguno de los recambios no existe o el recambio no es equivalente |
      operationId: recambios_equivalencias_get
      responses:
        '200':
          description: Recambio equivalente
          headers:
            ETag:
              $ref: "#/components/headers/ETag"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Recambio"
              examples:
                recambioExample:
                  $ref: "#/components/examples/recambio-example"
        '404':
          $ref: "#/components/responses/Response_404"
    head:
      summary: Comprueba si el recambio es equivalente
      description: |
        Los códigos de estado que puede devolver este endpoint son:
        | Status Code | Descripción          | Motivo                                                            |
        |-------------|----------------------|-------------------------------------------------------------------|
        | **200**     | `OK`                 | Ambos recambios existen y el recambio es equivalente              |
        | **404**     | `NOT FOUND`          | Alguno de los recambios no existe o el recambio no es equivalente |
      operationId: recambios_equivalencias_head
      responses:
        '200':
          description: El recambio es equivalente
          headers:
            ETag:
              $ref: "#/components/headers/ETag"
        '404':
          description: Alguno de los recambios no existe o el recambio no es equivalente
    post:
      summary: Añade un recambio equivalente al recambio. La operación es simétrica*
      description: |
        Los códigos de estado que puede devolver este endpoint son:
        | Status Code | Descripción          | Motivo                                                    |
        |-------------|----------------------|-----------------------------------------------------------|
        | **201**     | `CREATED`            | Se ha añadido la equivalencia del recambio                |
        | **404**     | `NOT FOUND`          | Alguno de los recambios no existe                         |
        | **409**     | `CONFLICT`           | Los recambios ya eran equivalentes                        |
        ---
        \* El recambio equivalente tendrá de equivalente también al recambio.
      operationId: recambios_equivalencias_post
      responses:
        '201':
          description: Equivalencia creada
        '404':
          $ref: "#/components/responses/Response_404"
        '409':
          $ref: "#/components/responses/Response_409"

components:
  schemas:
    Recambio:
      description: 'Información de un recambio'
      title: '⚙ Recambio'
      type: object
      required:
        - nombre
        - proveedor
        - modelo
        - cantidad
        - precio
      properties:
        id:
          type: integer
          format: int32
          description: Id de un recambio. Existe un único id para cada nombre + proveedor + modelo
          readOnly: true
        nombre:
          type: string
          description: Nombre del recambio
        descripcion:
          type: string
          description: Descripción del recambio
        proveedor:
          type: string
          description: Proveedor del recambio
        modelo:
          type: string
          description: Modelo del recambio
        equivalencias:
          type: array
          items:
              $ref: '#/components/schemas/Recambio'
          description: Referencia a otros recambios equivalentes
        cantidad:
          type: integer
          format: int32
          minimum: 0
          description: Cantidad de recambios
        vehiculos_compatibles:
          type: array
          items:
            type: string
          description: Lista de vehículos compatibles con el recambio
        peso:
          type: number
          format: float
          minimum: 0
          description: Peso del recambio en kilogramos
        dimensiones:
          type: object
          properties:
            alto:
              type: number
              format: float
              minimum: 0
              description: Alto en centímetros
            ancho:
              type: number
              format: float
              minimum: 0
              description: Ancho en centímetros
            largo:
              type: number
              format: float
              minimum: 0
              description: Largo en centímetros
          description: Dimensiones del recambio
        precio:
          type: integer
          format: int32
          minimum: 0
          description: Precio unitario de los recambios en euros
    HTTP_Problem:
      type: object
      externalDocs:
        url: https://tools.ietf.org/html/rfc7807
      description: Problem Details for HTTP APIs
      properties:
        type:
          type: string
          format: uri
          description: A URI reference [RFC3986] that identifies the problem type
        title:
          type: string
          description: short human-readable summary of the problem type
        status:
          type: number
          description: HTTP status code
        detail:
          type: string
          description: human-readable explanation specific to this occurrence of the problem
        instance:
          type: string
          format: uri
          description: "A URI reference that identifies the specific
                occurrence of the problem. It may or may not yield further
                information if dereferenced"
    Link:
      description: Enlace de relación
      title: '🔗 Link'
      type: object
      properties:
        href:
          description: URL del enlace
          type: string
          format: url
          x-faker: internet.url
        rel:
          description: "Relación del documento enlazado con el actual. Contiene una lista de tipos
                        de enlaces separados por espacio."
          type: string
          x-faker: lorem.words
  parameters:
    pageParam:
      name: page
      in: query
      description: Número de página
      required: false
      allowEmptyValue: false
      schema:
        type: integer
        minimum: 1
        default: 1
    limitParam:
      name: limit
      in: query
      description: >
        Número de recambios devueltos por cada página.
        Si es `0`, devuelve todos los recambios en una única página
      required: false
      allowEmptyValue: false
      schema:
        type: integer
        minimum: 0
        default: 10
    orderParam:
      name: order
      in: query
      description: 'Ordenación por: `id` | `nombre` | `proveedor` | `cantidad` | `precio`'
      required: false
      allowEmptyValue: false
      schema:
        type: string
        enum:
          - id
          - nombre
          - proveedor
          - cantidad
          - precio
        default: id
    orderingParam:
      name: ordering
      in: query
      description: 'Tipo de ordenación: `ASC` | `DESC`'
      required: false
      allowEmptyValue: false
      schema:
        type: string
        enum:
          - ASC
          - DESC
        default: ASC
    nombreFilterParam:
      name: nombreFilter
      in: query
      description: Filtro por nombre. Puede ser un substring del nombre
      required: false
      allowEmptyValue: false
      schema:
        type: string
    ifNoneMatchParam:
      name: If-None-Match
      in: header
      description: ETag del recurso
      required: false
      schema:
        type: string
        pattern: "[0-9a-f]*"
    recambioId:
      name: recambioId
      in: path
      description: Identificador único del recambio
      schema:
        type: integer
        format: int32
      required: true
    recambioEquivalenteId:
      name: recambioEquivalenteId
      in: path
      description: Identificador único del recambio equivalente
      schema:
        type: integer
        format: int32
      required: true

  headers:
    ETag:
      description: Entity Tag (identificador único proporcionado para validación de caché)
      schema:
        type: string
        pattern: "[0-9a-f]*"
        # https://github.com/marak/Faker.js#api-methods
        x-faker: random.uuid
        example:
          33a64df551425fcc

  responses:
    Response_404:
      description: '`NOT FOUND`: recurso no disponible'
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/HTTP_Problem'
          examples:
            response-http-404:
              $ref: '#/components/examples/response-http-404'
    Response_304:
      description: '`NOT MODIFIED`: El recurso solicitado no ha sido modificado'
      headers:
        ETag:
          $ref: "#/components/headers/ETag"
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/HTTP_Problem'
          examples:
            response-http-304:
              $ref: '#/components/examples/response-http-304'
    Response_409:
      description: '`CONFLICT`: El recurso que se ha intentado añadir ya existía'
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/HTTP_Problem'
          examples:
            response-http-409-recambios-equivalencias:
              $ref: '#/components/examples/response-http-409-recambios-equivalencias'
    Response_412:
      description: '`PRECONDITION FAILED`: El ETag proporcionado no está actualizado'
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/HTTP_Problem'
          examples:
            response-http-412:
              $ref: '#/components/examples/response-http-412'

    Response_422:
      description: >
        `UNPROCESSABLE ENTITY`
        Falta alguno de los atributos obligatorios (`nombre`, `empresa`, `version` o `año_publicación`)
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/HTTP_Problem'
          examples:
            response-http-422:
              $ref: '#/components/examples/response-http-422'

  examples:
    recambio-example:
      value:
        recambio:
          id: 2022
          nombre: 'Neumatico: Continental VancoCamper 215/70 R15CP 109R 8PR'
          descripcion: 'neumatico para coche'
          proveedor: 'Continental VancoCamper'
          modelo: '215/70 R15CP 109R 8PR'
          equivalencias: 'NO DISPONIBLE'
          cantidad: 20
          vehiculos_compatibles: ['Hyundai IONIQ Híbrido', 'Hundai i30 Fastback']
          peso: 5
          dimensiones: 40 40 20
          precio: 80

    response-http-404:
        value:
          type: https://httpstatuses.com/404
          title: NOT FOUND
          status: 404
          detail: El recurso solicitado no está disponible.
          instance: about:blank

    response-http-412:
        value:
          type: https://httpstatuses.com/412
          title: PRECONDITION FAILED
          status: 412
          detail: El ETag proporcionado no está actualizado
          instance: about:blank
    response-http-422:
      value:
        type: https://httpstatuses.com/422
        title: UNPROCESSABLE ENTITY
        status: 422
        detail: Falta alguno de los atributos obligatorios (nombre, empresa, version o año_publicación)
        instance: about:blank
    response-http-304:
      value:
        type: https://httpstatuses.com/304
        title: NOT MODIFIED
        status: 304
        detail: El recurso solicitado no ha sido modificado.
    response-http-409-recambios-equivalencias:
      value:
        type: https://httpstatuses.com/409
        title: CONFLICT
        status: 409
        detail: Se ha intentado añadir una equivalencia que ya existía.
